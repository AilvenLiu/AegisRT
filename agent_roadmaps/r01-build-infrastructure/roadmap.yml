# roadmap.yml -- Canonical Execution State
#
# This file is the ONLY authoritative source of execution progress.
# It must reflect completed work, not intentions.

roadmap:
  name: r01-build-infrastructure
  description: >
    Establish the complete, reproducible build environment: CMake 3.25+ with
    CUDA language support, Conan 2.x dependency management, Jetson Orin
    cross-compilation toolchain, clang-format/tidy/cppcheck quality gates,
    sanitizer build presets, CI pipeline, and a CUDA smoke test that proves
    the entire chain works end-to-end.

status:
  active: true
  blocked: false
  completed: false

current_focus:
  phase: phase-r01-a
  task: task-r01-a-0

phases:

  # ------------------------------------------------------------------
  # Sub-phase A: CMake project skeleton and Conan integration
  # ------------------------------------------------------------------
  - id: phase-r01-a
    title: "CMake Project Skeleton and Conan Integration"
    status: active
    tasks:
      - id: task-r01-a-0
        title: "Root CMakeLists.txt: project(AegisRT VERSION 0.1.0), C++20, CUDA 12.0+, cmake_minimum_required(3.25)"
        status: active
        notes: "Enable CUDA language via enable_language(CUDA). Set CMAKE_CUDA_STANDARD 20. Define install targets."

      - id: task-r01-a-1
        title: "CMake module directory: cmake/modules/ with AegisRTHelpers.cmake (add_aegisrt_library, add_aegisrt_test macros)"
        status: pending
        notes: "Macros enforce: -Wall -Wextra -Werror, correct include paths, RTTI off for CUDA targets."

      - id: task-r01-a-2
        title: "Conan 2.x integration: conanfile.txt [requires] GTest/1.14.0 spdlog/1.13.0; cmake/conan_provider.cmake"
        status: pending
        notes: "Use CMakeDeps + CMakeToolchain generators. Pin exact versions. Document in README."

      - id: task-r01-a-3
        title: "CMake build presets: CMakePresets.json with debug-x86, release-x86, asan, tsan, ubsan, debug-aarch64 presets"
        status: pending
        notes: "Presets reference conan_toolchain.cmake. ASAN preset adds -fsanitize=address,undefined. TSAN adds -fsanitize=thread."

      - id: task-r01-a-4
        title: "src/ and tests/ CMakeLists.txt scaffolding: empty aegisrt_core INTERFACE library, empty test runner target"
        status: pending
        notes: "tests/ links GTest::gtest_main. compile_commands.json generated for clang-tidy."

      - id: task-r01-a-5
        title: "Version header generation: cmake/version.hpp.in -> include/aegisrt/version.hpp with MAJOR/MINOR/PATCH macros"
        status: pending
        notes: "Use configure_file(). Version must match CMakeLists.txt project VERSION field exactly."

  # ------------------------------------------------------------------
  # Sub-phase B: Code quality toolchain
  # ------------------------------------------------------------------
  - id: phase-r01-b
    title: "Code Quality Toolchain"
    status: pending
    tasks:
      - id: task-r01-b-0
        title: ".clang-format: BasedOnStyle LLVM, ColumnLimit 100, SortIncludes true, IndentWidth 4, PointerAlignment Left"
        status: pending

      - id: task-r01-b-1
        title: ".clang-tidy: modernize-*, readability-*, cppcoreguidelines-*, performance-*, bugprone-*; suppress cert-* for CUDA"
        status: pending
        notes: "HeaderFilterRegex for src/ only. Suppress readability-magic-numbers in tests/."

      - id: task-r01-b-2
        title: "cppcheck config: .cppcheck with --enable=all --suppress=missingInclude --error-exitcode=1; cmake custom target"
        status: pending

      - id: task-r01-b-3
        title: "CUDA_CHECK macro: include/aegisrt/cuda/cuda_error.hpp -- CUDA_CHECK(expr), CUDA_CHECK_LAST(), prints file/line/func"
        status: pending
        notes: "Must abort with std::abort() in release builds. Must throw CudaError in debug builds."

      - id: task-r01-b-4
        title: "Pre-commit hook script: scripts/pre-commit.sh running clang-format --dry-run on staged .cpp/.hpp/.cu/.cuh files"
        status: pending
        notes: "cmake/install_hooks.cmake custom target installs hook. Documents manual install procedure."

  # ------------------------------------------------------------------
  # Sub-phase C: CI pipeline and cross-compilation
  # ------------------------------------------------------------------
  - id: phase-r01-c
    title: "CI Pipeline and Cross-Compilation"
    status: pending
    tasks:
      - id: task-r01-c-0
        title: "Jetson Orin cross-compilation toolchain: cmake/toolchains/jetson-orin-aarch64.cmake"
        status: pending
        notes: "CMAKE_SYSTEM_NAME Linux, CMAKE_SYSTEM_PROCESSOR aarch64, aarch64-linux-gnu-g++, CUDA aarch64 paths."

      - id: task-r01-c-1
        title: "CI workflow: .github/workflows/ci.yml jobs: build-x86, test-x86, cross-compile-aarch64, lint"
        status: pending
        notes: "build-x86: cmake --preset debug-x86 && cmake --build. test-x86: ctest. lint: format + tidy + cppcheck."

      - id: task-r01-c-2
        title: "CI sanitizer job: ASAN+UBSAN preset, run all tests, fail on any sanitizer error"
        status: pending
        notes: "Separate job to avoid ASAN overhead in main test run. Must pass before phase is complete."

      - id: task-r01-c-3
        title: "CI documentation: .github/workflows/README.md explaining required packages and local reproduction steps"
        status: pending

      - id: task-r01-c-4
        title: "CUDA smoke test: tests/smoke/smoke_test.cu -- device memory alloc, trivial kernel, CUDA_CHECK, cuda-memcheck clean"
        status: pending
        notes: "Must build on x86_64 and cross-compile for aarch64. Proves full CUDA toolchain works."

      - id: task-r01-c-5
        title: "Phase exit criteria verification: all CI jobs pass locally, clang-format clean, clang-tidy zero warnings"
        status: pending
        notes: "Document all criteria met. Update this roadmap.yml to completed. Write session handoff."
